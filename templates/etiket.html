<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Etiket Yazdır</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
  <style>
    @page { size: 100mm 100mm; margin: 0; }
    @media print {
      html, body { width: 100mm; height: 100mm; }
    }
    html, body {
      background: #fff;
      margin: 0; padding: 0;
    }
    .label-100 {
      width: 100mm; height: 100mm;
      background: #fff;
      box-sizing: border-box;
      padding: 4mm 5mm;
      display: flex; flex-direction: column; justify-content: space-between;
    }
    .row-top { display: flex; gap: 4mm; }
    .shop-badge {
      font-size: 12px; background: #e7f1ff; border: 1px solid #b6d4fe;
      padding: 2px 6px; border-radius: 6px; display: inline-block;
    }
    .tiny { font-size: 11px; line-height: 1.15; margin: 0; }
    .tiny-addr { max-height: 26mm; overflow: hidden; }
    .prod-list { font-size: 11px; margin: 0; padding-left: 14px; max-height: 22mm; overflow: hidden; }
    .barcode-wrap { width: 100%; text-align: center; }
    #barcode { width: 100%; height: 22mm; }
  </style>
</head>
<body>
  <div class="label-100">
    <div>
      <div class="d-flex justify-content-between align-items-center">
        <span class="shop-badge">{{ o['supplier_name'] }}</span>
        <span class="tiny">{{ o['orderDateFormatted'] }}</span>
      </div>
      <div class="row-top" style="margin-top: 2mm;">
        <div style="flex: 1;">
          <p class="tiny"><strong>Sipariş:</strong> {{ o['orderNumber'] }}</p>
          <p class="tiny"><strong>Paket ID:</strong> {{ o['id'] }}</p>
          <p class="tiny"><strong>Kargo:</strong> {{ o.get('cargoProviderName','-') }}</p>
        </div>
        <div style="flex: 1;">
          <p class="tiny"><strong>Alıcı:</strong> {{ o.get('shipmentAddress',{}).get('fullName','-') }}</p>
          <p class="tiny tiny-addr"><strong>Adres:</strong> {{ o.get('shipmentAddress',{}).get('fullAddress','-') }}</p>
        </div>
      </div>
    </div>

    <div>
      <p class="tiny" style="margin-bottom:1mm;"><strong>Ürünler</strong></p>
      <ol class="prod-list">
        {% for l in o.get('lines', []) %}
          <li>{{ l['productName'] }} (x{{ l['quantity'] }})</li>
        {% endfor %}
      </ol>
    </div>

    <div class="barcode-wrap">
      <svg id="barcode"></svg>
      <div class="tiny"><strong>Takip No:</strong> {{ o.get('cargoTrackingNumber','-') }}</div>
    </div>
  </div>

  <script>
    (function () {
      var code = "{{ o.get('cargoTrackingNumber', '') }}";
      code = (code || "").toString().trim();
      if (code) {
        JsBarcode("#barcode", code, {
          format: "CODE128",
          displayValue: true,
          fontSize: 10,
          height: 60,
          margin: 0,
          lineColor: "#000"
        });
      } else {
        var el = document.getElementById("barcode");
        if (el) el.style.display = "none";
      }
    })();
  </script>
</body>
</html>
